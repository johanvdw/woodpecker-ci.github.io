"use strict";(self.webpackChunkwoodpecker=self.webpackChunkwoodpecker||[]).push([[6130],{17942:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>k});var a=t(50959);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,i=e.originalType,p=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),c=s(t),m=l,k=c["".concat(p,".").concat(m)]||c[m]||u[m]||i;return t?a.createElement(k,o(o({ref:n},d),{},{components:t})):a.createElement(k,o({ref:n},d))}));function k(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var i=t.length,o=new Array(i);o[0]=m;var r={};for(var p in n)hasOwnProperty.call(n,p)&&(r[p]=n[p]);r.originalType=e,r[c]="string"==typeof e?e:l,o[1]=r;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},10051:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>f,contentTitle:()=>h,default:()=>y,frontMatter:()=>k,metadata:()=>g,toc:()=>b});var a=t(17942),l=Object.defineProperty,i=Object.defineProperties,o=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,d=(e,n,t)=>n in e?l(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,c=(e,n)=>{for(var t in n||(n={}))p.call(n,t)&&d(e,t,n[t]);if(r)for(var t of r(n))s.call(n,t)&&d(e,t,n[t]);return e},u=(e,n)=>i(e,o(n)),m=(e,n)=>{var t={};for(var a in e)p.call(e,a)&&n.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&r)for(var a of r(e))n.indexOf(a)<0&&s.call(e,a)&&(t[a]=e[a]);return t};const k={},h="Pipeline syntax",g={unversionedId:"usage/pipeline-syntax",id:"usage/pipeline-syntax",title:"Pipeline syntax",description:"The pipeline section defines a list of steps to build, test and deploy your code. Pipeline steps are executed serially, in the order in which they are defined. If a step returns a non-zero exit code, the pipeline immediately aborts and returns a failure status.",source:"@site/docs/20-usage/20-pipeline-syntax.md",sourceDirName:"20-usage",slug:"/usage/pipeline-syntax",permalink:"/docs/next/usage/pipeline-syntax",draft:!1,editUrl:"https://github.com/woodpecker-ci/woodpecker/edit/main/docs/docs/20-usage/20-pipeline-syntax.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Terminology",permalink:"/docs/next/usage/terminology"},next:{title:"Workflows",permalink:"/docs/next/usage/workflows"}},f={},b=[{value:"Skip Commits",id:"skip-commits",level:3},{value:"Steps",id:"steps",level:2},{value:"File changes are incremental",id:"file-changes-are-incremental",level:3},{value:"<code>image</code>",id:"image",level:3},{value:"Images from private registries",id:"images-from-private-registries",level:5},{value:"Global registry support",id:"global-registry-support",level:5},{value:"GCR registry support",id:"gcr-registry-support",level:5},{value:"Local Images",id:"local-images",level:5},{value:"<code>commands</code>",id:"commands",level:3},{value:"<code>environment</code>",id:"environment",level:3},{value:"<code>secrets</code>",id:"secrets",level:3},{value:"<code>failure</code>",id:"failure",level:3},{value:"<code>when</code> - Conditional Execution",id:"when---conditional-execution",level:3},{value:"<code>repo</code>",id:"repo",level:4},{value:"<code>branch</code>",id:"branch",level:4},{value:"<code>event</code>",id:"event",level:4},{value:"<code>cron</code>",id:"cron",level:4},{value:"<code>ref</code>",id:"ref",level:4},{value:"<code>status</code>",id:"status",level:4},{value:"<code>platform</code>",id:"platform",level:4},{value:"<code>environment</code>",id:"environment-1",level:4},{value:"<code>matrix</code>",id:"matrix",level:4},{value:"<code>instance</code>",id:"instance",level:4},{value:"<code>path</code>",id:"path",level:4},{value:"<code>evaluate</code>",id:"evaluate",level:4},{value:"<code>group</code> - Parallel execution",id:"group---parallel-execution",level:3},{value:"<code>volumes</code>",id:"volumes",level:3},{value:"<code>detach</code>",id:"detach",level:3},{value:"<code>directory</code>",id:"directory",level:3},{value:"<code>services</code>",id:"services",level:2},{value:"<code>workspace</code>",id:"workspace",level:2},{value:"<code>matrix</code>",id:"matrix-1",level:2},{value:"<code>labels</code>",id:"labels",level:2},{value:"Filter by platform",id:"filter-by-platform",level:3},{value:"<code>variables</code>",id:"variables",level:2},{value:"<code>clone</code>",id:"clone",level:2},{value:"Git Submodules",id:"git-submodules",level:3},{value:"<code>skip_clone</code>",id:"skip_clone",level:2},{value:"<code>when</code> - Global pipeline conditions",id:"when---global-pipeline-conditions",level:2},{value:"<code>repo</code>",id:"repo-1",level:3},{value:"<code>branch</code>",id:"branch-1",level:3},{value:"<code>event</code>",id:"event-1",level:3},{value:"<code>ref</code>",id:"ref-1",level:3},{value:"<code>environment</code>",id:"environment-2",level:3},{value:"<code>instance</code>",id:"instance-1",level:3},{value:"<code>path</code>",id:"path-1",level:3},{value:"<code>depends_on</code>",id:"depends_on",level:2},{value:"<code>runs_on</code>",id:"runs_on",level:2},{value:"Privileged mode",id:"privileged-mode",level:2}],N={toc:b},v="wrapper";function y(e){var n=e,{components:t}=n,l=m(n,["components"]);return(0,a.kt)(v,u(c(c({},N),l),{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",c({},{id:"pipeline-syntax"}),"Pipeline syntax"),(0,a.kt)("p",null,"The pipeline section defines a list of steps to build, test and deploy your code. Pipeline steps are executed serially, in the order in which they are defined. If a step returns a non-zero exit code, the pipeline immediately aborts and returns a failure status."),(0,a.kt)("p",null,"Example steps:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"steps:\n  backend:\n    image: golang\n    commands:\n      - go build\n      - go test\n  frontend:\n    image: node\n    commands:\n      - npm install\n      - npm run test\n      - npm run build\n")),(0,a.kt)("p",null,"In the above example we define two pipeline steps, ",(0,a.kt)("inlineCode",{parentName:"p"},"frontend")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"backend"),". The names of these steps are completely arbitrary."),(0,a.kt)("p",null,"Another way to name a step is by using the name keyword:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"steps:\n  - name: backend\n    image: golang\n    commands:\n      - go build\n      - go test\n  - name: frontend\n    image: node\n    commands:\n      - npm install\n      - npm run test\n      - npm run build\n")),(0,a.kt)("p",null,"Keep in mind the name is optional, if not added the steps will be numerated."),(0,a.kt)("h3",c({},{id:"skip-commits"}),"Skip Commits"),(0,a.kt)("p",null,"Woodpecker gives the ability to skip individual commits by adding ",(0,a.kt)("inlineCode",{parentName:"p"},"[SKIP CI]")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"[CI SKIP]")," to the commit message. Note this is case-insensitive."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-sh"}),'git commit -m "updated README [CI SKIP]"\n')),(0,a.kt)("h2",c({},{id:"steps"}),"Steps"),(0,a.kt)("p",null,"Every step of your pipeline executes arbitrary commands inside a specified container. The defined commands are executed serially.\nThe associated commit of a current pipeline run is checked out with git to a workspace which is mounted to every step of the pipeline as the working directory."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   backend:\n     image: golang\n     commands:\n+      - go build\n+      - go test\n")),(0,a.kt)("h3",c({},{id:"file-changes-are-incremental"}),"File changes are incremental"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Woodpecker clones the source code in the beginning pipeline"),(0,a.kt)("li",{parentName:"ul"},"Changes to files are persisted through steps as the same volume is mounted to all steps")),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),'# .woodpecker.yml\nsteps:\n  build:\n    image: debian\n    commands:\n      - echo "test content" > myfile\n  a-test-step:\n    image: debian\n    commands:\n      - cat myfile\n')),(0,a.kt)("h3",c({},{id:"image"}),(0,a.kt)("inlineCode",{parentName:"h3"},"image")),(0,a.kt)("p",null,"Woodpecker pulls the defined image and uses it as environment to execute the pipeline step commands, for plugins and for service containers."),(0,a.kt)("p",null,"When using the ",(0,a.kt)("inlineCode",{parentName:"p"},"local")," backend, the ",(0,a.kt)("inlineCode",{parentName:"p"},"image")," entry is used to specify the shell, such as Bash or Fish, that is used to run the commands."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   build:\n+    image: golang:1.6\n     commands:\n       - go build\n       - go test\n\n   publish:\n+    image: plugins/docker\n     repo: foo/bar\n\n services:\n   database:\n+    image: mysql\n")),(0,a.kt)("p",null,"Woodpecker supports any valid Docker image from any Docker registry:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-text"}),"image: golang\nimage: golang:1.7\nimage: library/golang:1.7\nimage: index.docker.io/library/golang\nimage: index.docker.io/library/golang:1.7\n")),(0,a.kt)("p",null,"Woodpecker does not automatically upgrade container images. Example configuration to always pull the latest image when updates are available:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   build:\n     image: golang:latest\n+    pull: true\n")),(0,a.kt)("h5",c({},{id:"images-from-private-registries"}),"Images from private registries"),(0,a.kt)("p",null,"You must provide registry credentials on the UI in order to pull private pipeline images defined in your YAML configuration file."),(0,a.kt)("p",null,"These credentials are never exposed to your pipeline, which means they cannot be used to push, and are safe to use with pull requests, for example. Pushing to a registry still require setting credentials for the appropriate plugin."),(0,a.kt)("p",null,"Example configuration using a private image:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   build:\n+    image: gcr.io/custom/golang\n     commands:\n       - go build\n       - go test\n")),(0,a.kt)("p",null,"Woodpecker matches the registry hostname to each image in your YAML. If the hostnames match, the registry credentials are used to authenticate to your registry and pull the image. Note that registry credentials are used by the Woodpecker agent and are never exposed to your build containers."),(0,a.kt)("p",null,"Example registry hostnames:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Image ",(0,a.kt)("inlineCode",{parentName:"li"},"gcr.io/foo/bar")," has hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"gcr.io")),(0,a.kt)("li",{parentName:"ul"},"Image ",(0,a.kt)("inlineCode",{parentName:"li"},"foo/bar")," has hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"docker.io")),(0,a.kt)("li",{parentName:"ul"},"Image ",(0,a.kt)("inlineCode",{parentName:"li"},"qux.com:8000/foo/bar")," has hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"qux.com:8000"))),(0,a.kt)("p",null,"Example registry hostname matching logic:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"gcr.io")," matches image ",(0,a.kt)("inlineCode",{parentName:"li"},"gcr.io/foo/bar")),(0,a.kt)("li",{parentName:"ul"},"Hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"docker.io")," matches ",(0,a.kt)("inlineCode",{parentName:"li"},"golang")),(0,a.kt)("li",{parentName:"ul"},"Hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"docker.io")," matches ",(0,a.kt)("inlineCode",{parentName:"li"},"library/golang")),(0,a.kt)("li",{parentName:"ul"},"Hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"docker.io")," matches ",(0,a.kt)("inlineCode",{parentName:"li"},"bradyrydzewski/golang")),(0,a.kt)("li",{parentName:"ul"},"Hostname ",(0,a.kt)("inlineCode",{parentName:"li"},"docker.io")," matches ",(0,a.kt)("inlineCode",{parentName:"li"},"bradyrydzewski/golang:latest"))),(0,a.kt)("h5",c({},{id:"global-registry-support"}),"Global registry support"),(0,a.kt)("p",null,"To make a private registry globally available check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/administration/server-config#global-registry-setting"}),"server configuration docs"),"."),(0,a.kt)("h5",c({},{id:"gcr-registry-support"}),"GCR registry support"),(0,a.kt)("p",null,"For specific details on configuring access to Google Container Registry, please view the docs ",(0,a.kt)("a",c({parentName:"p"},{href:"https://cloud.google.com/container-registry/docs/advanced-authentication#using_a_json_key_file"}),"here"),"."),(0,a.kt)("h5",c({},{id:"local-images"}),"Local Images"),(0,a.kt)("p",null,"It's possible to build a local image by mounting the docker socket as a volume."),(0,a.kt)("p",null,"With a ",(0,a.kt)("inlineCode",{parentName:"p"},"Dockerfile")," at the root of the project:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"steps:\n  build-image:\n    image: docker\n    commands:\n      - docker build --rm -t local/project-image .\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n\n  build-project:\n    image: local/project-image\n    commands:\n      - ./build.sh\n")),(0,a.kt)("admonition",c({},{type:"warning"}),(0,a.kt)("p",{parentName:"admonition"},"For this privileged rights are needed only available to admins. In addition this only works when using a single agent.")),(0,a.kt)("h3",c({},{id:"commands"}),(0,a.kt)("inlineCode",{parentName:"h3"},"commands")),(0,a.kt)("p",null,"Commands of every pipeline step are executed serially as if you would enter them into your local shell."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   backend:\n     image: golang\n     commands:\n+      - go build\n+      - go test\n")),(0,a.kt)("p",null,"There is no magic here. The above commands are converted to a simple shell script. The commands in the above example are roughly converted to the below script:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"#!/bin/sh\nset -e\n\ngo build\ngo test\n")),(0,a.kt)("p",null,"The above shell script is then executed as the container entrypoint. The below docker command is an (incomplete) example of how the script is executed:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"docker run --entrypoint=build.sh golang\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Please note that only build steps can define commands. You cannot use commands with plugins or services.")),(0,a.kt)("h3",c({},{id:"environment"}),(0,a.kt)("inlineCode",{parentName:"h3"},"environment")),(0,a.kt)("p",null,"Woodpecker provides the ability to pass environment variables to individual pipeline steps."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/environment"}),"environment docs"),"."),(0,a.kt)("h3",c({},{id:"secrets"}),(0,a.kt)("inlineCode",{parentName:"h3"},"secrets")),(0,a.kt)("p",null,"Woodpecker provides the ability to store named parameters external to the YAML configuration file, in a central secret store. These secrets can be passed to individual steps of the pipeline at runtime."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/secrets"}),"secrets docs"),"."),(0,a.kt)("h3",c({},{id:"failure"}),(0,a.kt)("inlineCode",{parentName:"h3"},"failure")),(0,a.kt)("p",null,"Some of the pipeline steps may be allowed to fail without causing the whole pipeline to report a failure (e.g., a step executing a linting check). To enable this, add ",(0,a.kt)("inlineCode",{parentName:"p"},"failure: ignore")," to your pipeline step. If Woodpecker encounters an error while executing the step, it will report it as failed but still execute the next steps of the pipeline, if any, without affecting the status of the pipeline."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   backend:\n     image: golang\n     commands:\n       - go build\n       - go test\n+    failure: ignore\n")),(0,a.kt)("h3",c({},{id:"when---conditional-execution"}),(0,a.kt)("inlineCode",{parentName:"h3"},"when")," - Conditional Execution"),(0,a.kt)("p",null,"Woodpecker supports defining a list of conditions for a pipeline step by using a ",(0,a.kt)("inlineCode",{parentName:"p"},"when")," block. If at least one of the conditions in the ",(0,a.kt)("inlineCode",{parentName:"p"},"when")," block evaluate to true the step is executed, otherwise it is skipped. A condition can be a check like:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   slack:\n     image: plugins/slack\n     settings:\n       channel: dev\n+    when:\n+      - event: pull_request\n+        repo: test/test\n+      - event: push\n+        branch: main\n")),(0,a.kt)("h4",c({},{id:"repo"}),(0,a.kt)("inlineCode",{parentName:"h4"},"repo")),(0,a.kt)("p",null,"Example conditional execution by repository:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   slack:\n     image: plugins/slack\n     settings:\n       channel: dev\n+    when:\n+      - repo: test/test\n")),(0,a.kt)("h4",c({},{id:"branch"}),(0,a.kt)("inlineCode",{parentName:"h4"},"branch")),(0,a.kt)("admonition",c({},{type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"Branch conditions are not applied to tags.")),(0,a.kt)("p",null,"Example conditional execution by branch:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"steps:\n  slack:\n    image: plugins/slack\n    settings:\n      channel: dev\n+   when:\n+     - branch: main\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The step now triggers on main branch, but also if the target branch of a pull request is ",(0,a.kt)("inlineCode",{parentName:"p"},"main"),". Add an event condition to limit it further to pushes on main only.")),(0,a.kt)("p",null,"Execute a step if the branch is ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"develop"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - branch: [main, develop]\n")),(0,a.kt)("p",null,"Execute a step if the branch starts with ",(0,a.kt)("inlineCode",{parentName:"p"},"prefix/*"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - branch: prefix/*\n")),(0,a.kt)("p",null,"The branch matching is done using ",(0,a.kt)("a",c({parentName:"p"},{href:"https://github.com/bmatcuk/doublestar/#usage"}),"doublestar"),", note that a pattern starting with ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," should be put between quotes and a literal ",(0,a.kt)("inlineCode",{parentName:"p"},"/")," needs to be escaped. A few examples:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"*\\\\/*")," to match patterns with exactly 1 ",(0,a.kt)("inlineCode",{parentName:"li"},"/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"*\\\\/**")," to match patters with at least 1 ",(0,a.kt)("inlineCode",{parentName:"li"},"/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"*")," to match patterns without ",(0,a.kt)("inlineCode",{parentName:"li"},"/")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"**")," to match everything")),(0,a.kt)("p",null,"Execute a step using custom include and exclude logic:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - branch:\n      include: [ main, release/* ]\n      exclude: [ release/1.0.0, release/1.1.* ]\n")),(0,a.kt)("h4",c({},{id:"event"}),(0,a.kt)("inlineCode",{parentName:"h4"},"event")),(0,a.kt)("p",null,"Available events: ",(0,a.kt)("inlineCode",{parentName:"p"},"push"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"pull_request"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"tag"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"deployment"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"cron"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"manual")),(0,a.kt)("p",null,"Execute a step if the build event is a ",(0,a.kt)("inlineCode",{parentName:"p"},"tag"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - event: tag\n")),(0,a.kt)("p",null,"Execute a step if the pipeline event is a ",(0,a.kt)("inlineCode",{parentName:"p"},"push")," to a specified branch:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  - event: push\n+   branch: main\n")),(0,a.kt)("p",null,"Execute a step for multiple events:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - event: [push, tag, deployment]\n")),(0,a.kt)("h4",c({},{id:"cron"}),(0,a.kt)("inlineCode",{parentName:"h4"},"cron")),(0,a.kt)("p",null,"This filter ",(0,a.kt)("strong",{parentName:"p"},"only")," applies to cron events and filters based on the name of a cron job."),(0,a.kt)("p",null,"Make sure to have a ",(0,a.kt)("inlineCode",{parentName:"p"},"event: cron")," condition in the ",(0,a.kt)("inlineCode",{parentName:"p"},"when"),"-filters as well."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - event: cron\n    cron: sync_* # name of your cron job\n")),(0,a.kt)("p",null,(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/cron"}),"Read more about cron")),(0,a.kt)("h4",c({},{id:"ref"}),(0,a.kt)("inlineCode",{parentName:"h4"},"ref")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ref")," filter compares the git reference against which the pipeline is executed.\nThis allows you to filter, for example, tags that must start with ",(0,a.kt)("strong",{parentName:"p"},"v"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - event: tag\n    ref: refs/tags/v*\n")),(0,a.kt)("h4",c({},{id:"status"}),(0,a.kt)("inlineCode",{parentName:"h4"},"status")),(0,a.kt)("p",null,"There are use cases for executing pipeline steps on failure, such as sending notifications for failed pipelines. Use the status constraint to execute steps even when the pipeline fails:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"steps:\n  slack:\n    image: plugins/slack\n    settings:\n      channel: dev\n+   when:\n+     - status: [ success, failure ]\n")),(0,a.kt)("h4",c({},{id:"platform"}),(0,a.kt)("inlineCode",{parentName:"h4"},"platform")),(0,a.kt)("admonition",c({},{type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"This condition should be used in conjunction with a ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/matrix-workflows#example-matrix-pipeline-using-multiple-platforms"}),"matrix")," pipeline as a regular pipeline will only executed by a single agent which only has one arch.")),(0,a.kt)("p",null,"Execute a step for a specific platform:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - platform: linux/amd64\n")),(0,a.kt)("p",null,"Execute a step for a specific platform using wildcards:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - platform:  [ linux/*, windows/amd64 ]\n")),(0,a.kt)("h4",c({},{id:"environment-1"}),(0,a.kt)("inlineCode",{parentName:"h4"},"environment")),(0,a.kt)("p",null,"Execute a step for deployment events matching the target deployment environment:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - environment: production\n  - event: deployment\n")),(0,a.kt)("h4",c({},{id:"matrix"}),(0,a.kt)("inlineCode",{parentName:"h4"},"matrix")),(0,a.kt)("p",null,"Execute a step for a single matrix permutation:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - matrix:\n      GO_VERSION: 1.5\n      REDIS_VERSION: 2.8\n")),(0,a.kt)("h4",c({},{id:"instance"}),(0,a.kt)("inlineCode",{parentName:"h4"},"instance")),(0,a.kt)("p",null,"Execute a step only on a certain Woodpecker instance matching the specified hostname:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - instance: stage.woodpecker.company.com\n")),(0,a.kt)("h4",c({},{id:"path"}),(0,a.kt)("inlineCode",{parentName:"h4"},"path")),(0,a.kt)("admonition",c({},{type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"Path conditions are applied only to ",(0,a.kt)("strong",{parentName:"p"},"push")," and ",(0,a.kt)("strong",{parentName:"p"},"pull_request")," events.\nIt is currently ",(0,a.kt)("strong",{parentName:"p"},"only available")," for GitHub, GitLab and Gitea (version 1.18.0 and newer)")),(0,a.kt)("p",null,"Execute a step only on a pipeline with certain files being changed:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),'when:\n  - path: "src/*"\n')),(0,a.kt)("p",null,"You can use ",(0,a.kt)("a",c({parentName:"p"},{href:"https://github.com/bmatcuk/doublestar#patterns"}),"glob patterns")," to match the changed files and specify if the step should run if a file matching that pattern has been changed ",(0,a.kt)("inlineCode",{parentName:"p"},"include")," or if some files have ",(0,a.kt)("strong",{parentName:"p"},"not")," been changed ",(0,a.kt)("inlineCode",{parentName:"p"},"exclude"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - path:\n      include: [ '.woodpecker/*.yml', '*.ini' ]\n      exclude: [ '*.md', 'docs/**' ]\n      ignore_message: \"[ALL]\"\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Hint:")," Passing a defined ignore-message like ",(0,a.kt)("inlineCode",{parentName:"p"},"[ALL]")," inside the commit message will ignore all path conditions."),(0,a.kt)("h4",c({},{id:"evaluate"}),(0,a.kt)("inlineCode",{parentName:"h4"},"evaluate")),(0,a.kt)("p",null,"Execute a step only if the provided evaluate expression is equal to true. Both built-in ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/environment#built-in-environment-variables"}),(0,a.kt)("inlineCode",{parentName:"a"},"CI_"))," and custom variables can be used inside the expression."),(0,a.kt)("p",null,"The expression syntax can be found in ",(0,a.kt)("a",c({parentName:"p"},{href:"https://github.com/antonmedv/expr/blob/master/docs/Language-Definition.md"}),"the docs")," of the underlying library."),(0,a.kt)("p",null,"Run on pushes to the default branch for the repository ",(0,a.kt)("inlineCode",{parentName:"p"},"owner/repo"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),'when:\n  - evaluate: \'CI_PIPELINE_EVENT == "push" && CI_REPO == "owner/repo" && CI_COMMIT_BRANCH == CI_REPO_DEFAULT_BRANCH\'\n')),(0,a.kt)("p",null,"Run on commits created by user ",(0,a.kt)("inlineCode",{parentName:"p"},"woodpecker-ci"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - evaluate: 'CI_COMMIT_AUTHOR == \"woodpecker-ci\"'\n")),(0,a.kt)("p",null,"Skip all commits containing ",(0,a.kt)("inlineCode",{parentName:"p"},"please ignore me")," in the commit message:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - evaluate: 'not (CI_COMMIT_MESSAGE contains \"please ignore me\")'\n")),(0,a.kt)("p",null,"Run on pull requests with the label ",(0,a.kt)("inlineCode",{parentName:"p"},"deploy"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - evaluate: 'CI_COMMIT_PULL_REQUEST_LABELS contains \"deploy\"'\n")),(0,a.kt)("p",null,"Skip step only if ",(0,a.kt)("inlineCode",{parentName:"p"},"SKIP=true"),", run otherwise or if undefined:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  - evaluate: 'SKIP != \"true\"'\n")),(0,a.kt)("h3",c({},{id:"group---parallel-execution"}),(0,a.kt)("inlineCode",{parentName:"h3"},"group")," - Parallel execution"),(0,a.kt)("p",null,"Woodpecker supports parallel step execution for same-machine fan-in and fan-out. Parallel steps are configured using the ",(0,a.kt)("inlineCode",{parentName:"p"},"group")," attribute. This instructs the pipeline runner to execute the named group in parallel."),(0,a.kt)("p",null,"Example parallel configuration:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   backend:\n+    group: build\n     image: golang\n     commands:\n       - go build\n       - go test\n   frontend:\n+    group: build\n     image: node\n     commands:\n       - npm install\n       - npm run test\n       - npm run build\n   publish:\n     image: plugins/docker\n     repo: octocat/hello-world\n")),(0,a.kt)("p",null,"In the above example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"frontend")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"backend")," steps are executed in parallel. The pipeline runner will not execute the ",(0,a.kt)("inlineCode",{parentName:"p"},"publish")," step until the group completes."),(0,a.kt)("h3",c({},{id:"volumes"}),(0,a.kt)("inlineCode",{parentName:"h3"},"volumes")),(0,a.kt)("p",null,"Woodpecker gives the ability to define Docker volumes in the YAML. You can use this parameter to mount files or folders on the host machine into your containers."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/volumes"}),"volumes docs"),"."),(0,a.kt)("h3",c({},{id:"detach"}),(0,a.kt)("inlineCode",{parentName:"h3"},"detach")),(0,a.kt)("p",null,"Woodpecker gives the ability to detach steps to run them in background until the pipeline finishes."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/services#detachment"}),"service docs"),"."),(0,a.kt)("h3",c({},{id:"directory"}),(0,a.kt)("inlineCode",{parentName:"h3"},"directory")),(0,a.kt)("p",null,"Using ",(0,a.kt)("inlineCode",{parentName:"p"},"directory"),", you can set a subdirectory of your repository or an absolute path inside the Docker container in which your commands will run."),(0,a.kt)("h2",c({},{id:"services"}),(0,a.kt)("inlineCode",{parentName:"h2"},"services")),(0,a.kt)("p",null,"Woodpecker can provide service containers. They can for example be used to run databases or cache containers during the execution of pipeline."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/services"}),"services docs"),"."),(0,a.kt)("h2",c({},{id:"workspace"}),(0,a.kt)("inlineCode",{parentName:"h2"},"workspace")),(0,a.kt)("p",null,"The workspace defines the shared volume and working directory shared by all pipeline steps. The default workspace matches the below pattern, based on your repository URL."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-txt"}),"/woodpecker/src/github.com/octocat/hello-world\n")),(0,a.kt)("p",null,"The workspace can be customized using the workspace block in the YAML file:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"+workspace:\n+  base: /go\n+  path: src/github.com/octocat/hello-world\n\n steps:\n   build:\n     image: golang:latest\n     commands:\n       - go get\n       - go test\n")),(0,a.kt)("p",null,"The base attribute defines a shared base volume available to all pipeline steps. This ensures your source code, dependencies and compiled binaries are persisted and shared between steps."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," workspace:\n+  base: /go\n   path: src/github.com/octocat/hello-world\n\n steps:\n   deps:\n     image: golang:latest\n     commands:\n       - go get\n       - go test\n   build:\n     image: node:latest\n     commands:\n       - go build\n")),(0,a.kt)("p",null,"This would be equivalent to the following docker commands:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-sh"}),"docker volume create my-named-volume\n\ndocker run --volume=my-named-volume:/go golang:latest\ndocker run --volume=my-named-volume:/go node:latest\n")),(0,a.kt)("p",null,"The path attribute defines the working directory of your build. This is where your code is cloned and will be the default working directory of every step in your build process. The path must be relative and is combined with your base path."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," workspace:\n   base: /go\n+  path: src/github.com/octocat/hello-world\n")),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-text"}),"git clone https://github.com/octocat/hello-world \\\n  /go/src/github.com/octocat/hello-world\n")),(0,a.kt)("h2",c({},{id:"matrix-1"}),(0,a.kt)("inlineCode",{parentName:"h2"},"matrix")),(0,a.kt)("p",null,"Woodpecker has integrated support for matrix builds. Woodpecker executes a separate build task for each combination in the matrix, allowing you to build and test a single commit against multiple configurations."),(0,a.kt)("p",null,"For more details check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/matrix-workflows"}),"matrix build docs"),"."),(0,a.kt)("h2",c({},{id:"labels"}),(0,a.kt)("inlineCode",{parentName:"h2"},"labels")),(0,a.kt)("p",null,"You can set labels for your pipeline to select an agent to execute the pipeline on. An agent will pick up and run a pipeline when ",(0,a.kt)("strong",{parentName:"p"},"every")," label assigned to a pipeline matches the agents labels."),(0,a.kt)("p",null,"To set additional agent labels check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/administration/agent-config#woodpecker_filter_labels"}),"agent configuration options"),". Agents will have at least four default labels: ",(0,a.kt)("inlineCode",{parentName:"p"},"platform=agent-os/agent-arch"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"hostname=my-agent"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"backend=docker")," (type of the agent backend) and ",(0,a.kt)("inlineCode",{parentName:"p"},"repo=*"),". Agents can use a ",(0,a.kt)("inlineCode",{parentName:"p"},"*")," as a wildcard for a label. For example ",(0,a.kt)("inlineCode",{parentName:"p"},"repo=*")," will match every repo."),(0,a.kt)("p",null,"Pipeline labels with an empty value will be ignored.\nBy default each pipeline has at least the ",(0,a.kt)("inlineCode",{parentName:"p"},"repo=your-user/your-repo-name")," label. If you have set the ",(0,a.kt)("a",c({parentName:"p"},{href:"#platform"}),"platform attribute")," for your pipeline it will have a label like ",(0,a.kt)("inlineCode",{parentName:"p"},"platform=your-os/your-arch")," as well."),(0,a.kt)("p",null,"You can add additional labels as a key value map:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),'+labels:\n+  location: europe # only agents with `location=europe` or `location=*` will be used\n+  weather: sun\n+  hostname: "" # this label will be ignored as it is empty\n\nsteps:\n  build:\n    image: golang\n    commands:\n      - go build\n      - go test\n')),(0,a.kt)("h3",c({},{id:"filter-by-platform"}),"Filter by platform"),(0,a.kt)("p",null,"To configure your pipeline to only be executed on an agent with a specific platform, you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"platform")," key.\nHave a look at the official ",(0,a.kt)("a",c({parentName:"p"},{href:"https://go.dev/doc/install/source"}),"go docs")," for the available platforms. The syntax of the platform is ",(0,a.kt)("inlineCode",{parentName:"p"},"GOOS/GOARCH")," like ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/arm64")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/amd64"),"."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("p",null,"Assuming we have two agents, one ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/arm")," and one ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/amd64"),". Previously this pipeline would have executed on ",(0,a.kt)("strong",{parentName:"p"},"either agent"),", as Woodpecker is not fussy about where it runs the pipelines. By setting the following option it will only be executed on an agent with the platform ",(0,a.kt)("inlineCode",{parentName:"p"},"linux/arm64"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"+labels:\n+  platform: linux/arm64\n\nsteps:\n  [...]\n")),(0,a.kt)("h2",c({},{id:"variables"}),(0,a.kt)("inlineCode",{parentName:"h2"},"variables")),(0,a.kt)("p",null,"Woodpecker supports ",(0,a.kt)("a",c({parentName:"p"},{href:"https://yaml.org/spec/1.2.2/#3222-anchors-and-aliases"}),"YAML anchors & aliases")," in the pipeline configuration. These can be used as variables to not repeat yourself."),(0,a.kt)("p",null,"For more details and examples check the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/advanced-yaml-syntax"}),"Advanced YAML syntax docs")),(0,a.kt)("h2",c({},{id:"clone"}),(0,a.kt)("inlineCode",{parentName:"h2"},"clone")),(0,a.kt)("p",null,"Woodpecker automatically configures a default clone step if not explicitly defined. When using the ",(0,a.kt)("inlineCode",{parentName:"p"},"local")," backend, the ",(0,a.kt)("a",c({parentName:"p"},{href:"https://github.com/woodpecker-ci/plugin-git"}),"plugin-git")," binary must be on your ",(0,a.kt)("inlineCode",{parentName:"p"},"$PATH")," for the default clone step to work. If not, you can still write a manual clone step."),(0,a.kt)("p",null,"You can manually configure the clone step in your pipeline for customization:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"+clone:\n+  git:\n+    image: woodpeckerci/plugin-git\n\n steps:\n   build:\n     image: golang\n     commands:\n       - go build\n       - go test\n")),(0,a.kt)("p",null,"Example configuration to override depth:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," clone:\n   git:\n     image: woodpeckerci/plugin-git\n+    settings:\n+      partial: false\n+      depth: 50\n")),(0,a.kt)("p",null,"Example configuration to use a custom clone plugin:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"clone:\n  git:\n+   image: octocat/custom-git-plugin\n")),(0,a.kt)("p",null,"Example configuration to clone Mercurial repository:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," clone:\n   hg:\n+    image: plugins/hg\n+    settings:\n+      path: bitbucket.org/foo/bar\n")),(0,a.kt)("h3",c({},{id:"git-submodules"}),"Git Submodules"),(0,a.kt)("p",null,"To use the credentials that cloned the repository to clone it's submodules, update ",(0,a.kt)("inlineCode",{parentName:"p"},".gitmodules")," to use ",(0,a.kt)("inlineCode",{parentName:"p"},"https")," instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"git"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),' [submodule "my-module"]\n path = my-module\n-url = git@github.com:octocat/my-module.git\n+url = https://github.com/octocat/my-module.git\n')),(0,a.kt)("p",null,"To use the ssh git url in ",(0,a.kt)("inlineCode",{parentName:"p"},".gitmodules")," for users cloning with ssh, and also use the https url in Woodpecker, add ",(0,a.kt)("inlineCode",{parentName:"p"},"submodule_override"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," clone:\n   git:\n     image: woodpeckerci/plugin-git\n     settings:\n       recursive: true\n+      submodule_override:\n+        my-module: https://github.com/octocat/my-module.git\n\nsteps:\n  ...\n")),(0,a.kt)("h2",c({},{id:"skip_clone"}),(0,a.kt)("inlineCode",{parentName:"h2"},"skip_clone")),(0,a.kt)("p",null,"By default Woodpecker is automatically adding a clone step. This clone step can be configured by the ",(0,a.kt)("a",c({parentName:"p"},{href:"#clone"}),"clone")," property. If you do not need a ",(0,a.kt)("inlineCode",{parentName:"p"},"clone")," step at all you can skip it using:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"skip_clone: true\n")),(0,a.kt)("h2",c({},{id:"when---global-pipeline-conditions"}),(0,a.kt)("inlineCode",{parentName:"h2"},"when")," - Global pipeline conditions"),(0,a.kt)("p",null,"Woodpecker gives the ability to skip whole pipelines (not just steps #when---conditional-execution-1) based on certain conditions by a ",(0,a.kt)("inlineCode",{parentName:"p"},"when")," block. If all conditions in the ",(0,a.kt)("inlineCode",{parentName:"p"},"when")," block evaluate to true the pipeline is executed, otherwise it is skipped, but treated as successful and other pipelines depending on it will still continue."),(0,a.kt)("h3",c({},{id:"repo-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"repo")),(0,a.kt)("p",null,"Example conditional execution by repository:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"+when:\n+  repo: test/test\n+\n steps:\n   slack:\n     image: plugins/slack\n     settings:\n       channel: dev\n")),(0,a.kt)("h3",c({},{id:"branch-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"branch")),(0,a.kt)("admonition",c({},{type:"note"}),(0,a.kt)("p",{parentName:"admonition"},"Branch conditions are not applied to tags.")),(0,a.kt)("p",null,"Example conditional execution by branch:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"+when:\n+  branch: main\n+\n steps:\n   slack:\n     image: plugins/slack\n     settings:\n       channel: dev\n")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The step now triggers on main, but also if the target branch of a pull request is ",(0,a.kt)("inlineCode",{parentName:"p"},"main"),". Add an event condition to limit it further to pushes on main only.")),(0,a.kt)("p",null,"Execute a step if the branch is ",(0,a.kt)("inlineCode",{parentName:"p"},"main")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"develop"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  branch: [main, develop]\n")),(0,a.kt)("p",null,"Execute a step if the branch starts with ",(0,a.kt)("inlineCode",{parentName:"p"},"prefix/*"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  branch: prefix/*\n")),(0,a.kt)("p",null,"Execute a step using custom include and exclude logic:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  branch:\n    include: [ main, release/* ]\n    exclude: [ release/1.0.0, release/1.1.* ]\n")),(0,a.kt)("h3",c({},{id:"event-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"event")),(0,a.kt)("p",null,"Execute a step if the build event is a ",(0,a.kt)("inlineCode",{parentName:"p"},"tag"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  event: tag\n")),(0,a.kt)("p",null,"Execute a step if the pipeline event is a ",(0,a.kt)("inlineCode",{parentName:"p"},"push")," to a specified branch:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  event: push\n+ branch: main\n")),(0,a.kt)("p",null,"Execute a step for all non-pull request events:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  event: [push, tag, deployment]\n")),(0,a.kt)("p",null,"Execute a step for all build events:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  event: [push, pull_request, tag, deployment]\n")),(0,a.kt)("h3",c({},{id:"ref-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"ref")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"ref")," filter compares the git reference against which the pipeline is executed.\nThis allows you to filter, for example, tags that must start with ",(0,a.kt)("strong",{parentName:"p"},"v"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-yaml"}),"when:\n  event: tag\n  ref: refs/tags/v*\n")),(0,a.kt)("h3",c({},{id:"environment-2"}),(0,a.kt)("inlineCode",{parentName:"h3"},"environment")),(0,a.kt)("p",null,"Execute a step for deployment events matching the target deployment environment:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  environment: production\n  event: deployment\n")),(0,a.kt)("h3",c({},{id:"instance-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"instance")),(0,a.kt)("p",null,"Execute a step only on a certain Woodpecker instance matching the specified hostname:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  instance: stage.woodpecker.company.com\n")),(0,a.kt)("h3",c({},{id:"path-1"}),(0,a.kt)("inlineCode",{parentName:"h3"},"path")),(0,a.kt)("admonition",c({},{type:"info"}),(0,a.kt)("p",{parentName:"admonition"},"Path conditions are applied only to ",(0,a.kt)("strong",{parentName:"p"},"push")," and ",(0,a.kt)("strong",{parentName:"p"},"pull_request")," events.\nIt is currently ",(0,a.kt)("strong",{parentName:"p"},"only available")," for GitHub, GitLab and Gitea (version 1.18.0 and newer)")),(0,a.kt)("p",null,"Execute a step only on a pipeline with certain files being changed:"),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),'when:\n  path: "src/*"\n')),(0,a.kt)("p",null,"You can use ",(0,a.kt)("a",c({parentName:"p"},{href:"https://github.com/bmatcuk/doublestar#patterns"}),"glob patterns")," to match the changed files and specify if the step should run if a file matching that pattern has been changed ",(0,a.kt)("inlineCode",{parentName:"p"},"include")," or if some files have ",(0,a.kt)("strong",{parentName:"p"},"not")," been changed ",(0,a.kt)("inlineCode",{parentName:"p"},"exclude"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"}),"when:\n  path:\n    include: [ '.woodpecker/*.yml', '*.ini' ]\n    exclude: [ '*.md', 'docs/**' ]\n    ignore_message: \"[ALL]\"\n")),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"Hint:")," Passing a defined ignore-message like ",(0,a.kt)("inlineCode",{parentName:"p"},"[ALL]")," inside the commit message will ignore all path conditions."),(0,a.kt)("h2",c({},{id:"depends_on"}),(0,a.kt)("inlineCode",{parentName:"h2"},"depends_on")),(0,a.kt)("p",null,"Woodpecker supports to define multiple workflows for a repository. Those workflows will run independent from each other. To depend them on each other you can use the ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/workflows#flow-control"}),(0,a.kt)("inlineCode",{parentName:"a"},"depends_on"))," keyword."),(0,a.kt)("h2",c({},{id:"runs_on"}),(0,a.kt)("inlineCode",{parentName:"h2"},"runs_on")),(0,a.kt)("p",null,"Workflows that should run even on failure should set the ",(0,a.kt)("inlineCode",{parentName:"p"},"runs_on")," tag. See ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/workflows#flow-control"}),"here")," for an example."),(0,a.kt)("h2",c({},{id:"privileged-mode"}),"Privileged mode"),(0,a.kt)("p",null,"Woodpecker gives the ability to configure privileged mode in the YAML. You can use this parameter to launch containers with escalated capabilities."),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Privileged mode is only available to trusted repositories and for security reasons should only be used in private environments. See ",(0,a.kt)("a",c({parentName:"p"},{href:"/docs/next/usage/project-settings#trusted"}),"project settings")," to enable trusted mode.")),(0,a.kt)("pre",null,(0,a.kt)("code",c({parentName:"pre"},{className:"language-diff"})," steps:\n   build:\n     image: docker\n     environment:\n       - DOCKER_HOST=tcp://docker:2375\n     commands:\n       - docker --tls=false ps\n\n services:\n   docker:\n     image: docker:dind\n     commands: dockerd-entrypoint.sh --storage-driver=vfs --tls=false\n+    privileged: true\n")))}y.isMDXComponent=!0}}]);